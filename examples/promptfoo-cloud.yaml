# Example: Promptfoo Cloud Configuration
# The original use case that inspired crabcode

session_name: crab
workspace_base: ~/Dev-Promptfoo/subfolder
main_repo: ~/Dev-Promptfoo/promptfoo-cloud

workspaces:
  count: 5
  prefix: cloud-workspace
  branch_pattern: workspace-{N}

ports:
  api_base: 3200    # ws1=3201, ws2=3202, etc.
  app_base: 3000    # ws1=3001, ws2=3002, etc.

install_command: pnpm install

layout:
  panes:
    - name: terminal
      command: ""
    - name: server
      command: pnpm dev
    - name: main
      command: claude --dangerously-skip-permissions --chrome

env_sync:
  files:
    - path: server/.env
      copy_from: server/.env.example
      ports: [API_PORT, ADMIN_PORT]   # managed: incremented per workspace
    - path: app/.env
      copy_from: app/.env.example
      ports: [VITE_PORT]
      refs:                            # URL vars that reference managed ports
        VITE_API_URL: API_PORT         # rewrites :3200 → :3201 for ws1
    - path: promptfoo/.env
      copy_from: promptfoo/.env.example
      refs:
        PROMPTFOO_REMOTE_GENERATION_URL: API_PORT

submodules:
  - path: promptfoo
    reset_to: origin/main
    install_command: pnpm install

cleanup:
  preserve_files: ".env"
  kill_pattern: "cloud-workspace-{N}.*pnpm|cloud-workspace-{N}.*node"

# Shared volume: persists across workspace resets
# Great for local experiments, PR reviews, research notes
shared_volume:
  enabled: true
  path: ~/.crabcode/shared    # Central location for shared files
  link_as: .local             # Symlink name in each workspace

# Toolkit configuration (for crab tk share)
toolkit:
  share:
    # Default upload service: transfer.sh, 0x0.st
    service: transfer.sh

  # Slack integration (optional)
  # Get token: https://api.slack.com/apps → Create App → OAuth & Permissions
  # Required scopes: files:write, channels:read
  # slack:
  #   token: xoxb-your-bot-token
  #   default_channel: "#dev"

  # Email via mutt/msmtp (optional)
  # Configure msmtp: ~/.msmtprc
  # email:
  #   from: you@example.com
